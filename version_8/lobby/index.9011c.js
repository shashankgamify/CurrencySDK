window.__require=function t(e,o,n){function r(c,a){if(!o[c]){if(!e[c]){var u=c.split("/");if(u=u[u.length-1],!e[u]){var l="function"==typeof __require&&__require;if(!a&&l)return l(u,!0);if(i)return i(u,!0);throw new Error("Cannot find module '"+c+"'")}c=u}var p=o[c]={exports:{}};e[c][0].call(p.exports,function(t){return r(e[c][1][t]||t)},p,p.exports,t,e,o,n)}return o[c].exports}for(var i="function"==typeof __require&&__require,c=0;c<n.length;c++)r(n[c]);return r}({LobbyController:[function(t,e,o){"use strict";cc._RF.push(e,"8d6f1VVaFBEYoturSyoOjfc","LobbyController");var n,r=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,n){var r,i=arguments.length,c=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,n);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(c=(i<3?r(c):i>3?r(e,o,c):r(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c},c=this&&this.__awaiter||function(t,e,o,n){return new(o||(o=Promise))(function(r,i){function c(t){try{u(n.next(t))}catch(e){i(e)}}function a(t){try{u(n.throw(t))}catch(e){i(e)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(c,a)}u((n=n.apply(t,e||[])).next())})},a=this&&this.__generator||function(t,e){var o,n,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(t){return function(e){return u([t,e])}}function u(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,n=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=e.call(t,c)}catch(a){i=[6,a],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0});var u,l=cc._decorator,p=l.ccclass,s=l.property;(function(t){t[t.E_SHOW=0]="E_SHOW",t[t.E_HIDE=1]="E_HIDE",t[t.E_TRANSIT=2]="E_TRANSIT"})(u||(u={}));var f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.confirmPopup=null,e.msgLabel=null,e.buttonImage=null,e.fillImgWrapper=null,e._isLobbyEnabled=!1,e._lobbyURL=null,e._popupState=u.E_HIDE,e}return r(e,t),Object.defineProperty(e.prototype,"isLobbyEnabled",{get:function(){return this._isLobbyEnabled},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){},e.prototype.getMsgLabelStr=function(){return this.msgLabel.getComponent(cc.Label).string},e.prototype.setMsg=function(t){this.msgLabel.getComponent(cc.Label).string=t},e.prototype.start=function(){},e.prototype.init=function(t,e){return c(this,void 0,void 0,function(){var o;return a(this,function(n){switch(n.label){case 0:return this._isLobbyEnabled=!cc.sys.isMobile&&("true"===t.homeButton||!0===t.homeButton),this.isLobbyEnabled?(o=new URLSearchParams(window.location.search),this._lobbyURL=o.get("redirectUrl"),this.isURLValid(this._lobbyURL)?(this._lobbyURL=decodeURIComponent(this._lobbyURL),[3,3]):[3,1]):[3,4];case 1:return[4,this.getAPIRedirectURL(e)];case 2:n.sent(),n.label=3;case 3:this.addBtnToDom(),n.label=4;case 4:return[2]}})})},e.prototype.isURLValid=function(t){return null!=t&&null!=t&&"#"!=t&&t.length>0},e.prototype.getAPIRedirectURL=function(t){return c(this,void 0,void 0,function(){var e,o,n=this;return a(this,function(r){switch(r.label){case 0:return o={brandCode:(e=t).brandCode,groupCode:e.groupCode,playerToken:e.playerToken},[4,new Promise(function(t){n.getHttp(e.envURL+"/client/lobby-url",o,function(e,o){if(e)return cc.error(e),void t();n._lobbyURL=decodeURIComponent(JSON.parse(o).url),t()})})];case 1:return r.sent(),[2]}})})},e.prototype.addBtnToDom=function(){var t=document.createElement("style");t.innerText=".lobbyBtn{width:60px;height:60px;position:absolute;right:0;top:0;margin-top:20px;margin-right:20px;border-radius:50%;background-color:#763a00;padding:0;border:0;}.lobbyBtn:hover{background-color:#fca14c;}.lobbyBtn:active{background-color:#4b4b4b;}",document.head.appendChild(t),this.fillImgWrapper=document.createElement("button"),this.fillImgWrapper.className="lobbyBtn";var e=document.createElement("img");e.className="lobbyBtnImg",e.src=this.buttonImage.getTexture().url,e.addEventListener("click",this.onLobbyBtnPressed.bind(this)),this.fillImgWrapper.appendChild(e),document.body.appendChild(this.fillImgWrapper)},e.prototype.onLobbyBtnPressed=function(){return c(this,void 0,void 0,function(){var t=this;return a(this,function(e){switch(e.label){case 0:return this._popupState!=u.E_HIDE?[2]:(this._popupState=u.E_TRANSIT,cc.Tween.stopAllByTarget(this.confirmPopup),this.confirmPopup.opacity=0,this.confirmPopup.active=!0,[4,new Promise(function(e){cc.tween(t.confirmPopup).to(.4,{opacity:255}).call(e.bind(t)).start()})]);case 1:return e.sent(),this.confirmPopup.opacity=255,this._popupState=u.E_SHOW,[2]}})})},e.prototype.onCancel=function(){return c(this,void 0,void 0,function(){var t=this;return a(this,function(e){switch(e.label){case 0:return this._popupState!=u.E_SHOW?[2]:(this._popupState=u.E_TRANSIT,cc.Tween.stopAllByTarget(this.confirmPopup),this.confirmPopup.active=!0,this.confirmPopup.opacity=255,[4,new Promise(function(e){cc.tween(t.confirmPopup).to(.4,{opacity:0}).call(e.bind(t)).start()})]);case 1:return e.sent(),this.confirmPopup.active=!1,this.confirmPopup.opacity=255,this._popupState=u.E_HIDE,[2]}})})},e.prototype.onConfirmRedirectToLobby=function(){return c(this,void 0,void 0,function(){return a(this,function(){return this._popupState!=u.E_SHOW?[2]:(this._popupState=u.E_TRANSIT,this.isURLValid(this._lobbyURL)?window.location.replace(this._lobbyURL):cc.error("Invalid redirect URL "+this._lobbyURL),this._popupState=u.E_SHOW,[2])})})},e.prototype.getHttp=function(t,e,o,n){void 0===n&&(n=null);var r=new XMLHttpRequest,i="";if(e&&Array.isArray(e)&&e.length>0)for(var c=0;c<e.length;c++)i=0==c?i+"?"+e[c][0]+"="+e[c][1]:i+"&"+e[c][0]+"="+e[c][1];else if("object"==typeof e){for(var a in i+="?",e)i+=a+"="+e[a]+"&";i=i.substr(0,i.length-1)}var u=t+i;r.open("GET",u,!0),r.onloadend=function(){4==r.readyState&&200==r.status?o(null,r.responseText):4==r.readyState&&o(r.responseText,null)},r.onerror=function(t){o(t,null)},r.ontimeout=function(t){o(t,null)},n&&r.setRequestHeader("Authorization","Bearer "+n),r.send()},e.prototype.setButtonColor=function(t){if(this.isLobbyEnabled)if(t.match(/[0-9A-Fa-f]{6}/g)){var e=document.createElement("style");e.innerText=".lobbyBtn_1{background-color:"+t+"}",document.head.appendChild(e),this.fillImgWrapper.classList.add("lobbyBtn_1")}else cc.log("Color string is invalid - ",t)},i([s(cc.Node)],e.prototype,"confirmPopup",void 0),i([s(cc.Node)],e.prototype,"msgLabel",void 0),i([s(cc.SpriteFrame)],e.prototype,"buttonImage",void 0),i([p],e)}(cc.Component);o.default=f,cc._RF.pop()},{}]},{},["LobbyController"]);